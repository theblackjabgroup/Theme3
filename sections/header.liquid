<link rel="stylesheet" href="{{ 'section-header.css' | asset_url }}" media="print" onload="this.media='all'">
<noscript>{{ 'section-header.css' | asset_url | stylesheet_tag }}</noscript>

<header class="floating-dock-header">
  <nav class="floating-dock">
    <ul class="dock-menu">
      {%- for link in section.settings.menu.links -%}
        <li class="dock-menu-item">
          {%- if link.links != blank -%}
            {%- assign matching_block = null -%}
            {%- for block in section.blocks -%}
              {%- if block.type == 'mega_menu' and block.settings.link_name == link.title -%}
                {%- assign matching_block = block -%}
                {%- break -%}
              {%- endif -%}
            {%- endfor -%}

            <button
              class="dock-link dock-link--dropdown"
              aria-expanded="false"
              aria-controls="MegaMenu-{{ forloop.index }}"
              data-mega-menu-trigger
            >
              {{ link.title }}
              <svg viewBox="0 0 10 6" aria-hidden="true" focusable="false" class="icon-caret">
                <path fill-rule="evenodd" clip-rule="evenodd" d="M9.354.646a.5.5 0 00-.708 0L5 4.293 1.354.646a.5.5 0 00-.708.708l4 4a.5.5 0 00.708 0l4-4a.5.5 0 000-.708z" fill="currentColor"/>
              </svg>
            </button>

            <div id="MegaMenu-{{ forloop.index }}" class="mega-menu" data-mega-menu>
              <div class="mega-menu-inner">
                <div class="mega-menu-nav">
                  <ul class="mega-menu-list">
                    {%- for childlink in link.links -%}
                      <li class="mega-menu-item">
                        <a href="{{ childlink.url }}" class="mega-menu-link">
                          {{ childlink.title }}
                        </a>
                      </li>
                    {%- endfor -%}
                  </ul>
                </div>
                {%- if matching_block != null -%}
                  <div class="mega-menu-featured">
                    <div class="mega-menu-grid">
                      {%- for i in (1..4) -%}
                        {%- assign img_key = 'image_' | append: i -%}
                        {%- assign label_key = 'label_' | append: i -%}
                        {%- assign link_key = 'link_' | append: i -%}
                        {%- assign img = matching_block.settings[img_key] -%}
                        {%- assign label = matching_block.settings[label_key] -%}
                        {%- assign url = matching_block.settings[link_key] -%}

                        {%- if img != blank -%}
                          {%- assign product_count = null -%}
                          {%- if url contains '/collections/' -%}
                            {%- assign url_parts = url | split: '/' -%}
                            {%- assign collection_handle = url_parts | last | split: '?' | first -%}
                            {%- assign product_count = collections[collection_handle].products_count -%}
                          {%- endif -%}

                          <a href="{{ url | default: '#' }}" class="mega-menu-featured-item">
                            <div class="mega-menu-image-wrapper">
                              {{ img | image_url: width: 400 | image_tag: loading: 'lazy', class: 'mega-menu-image' }}
                            </div>
                            {%- if label != blank -%}
                              <div class="mega-menu-label">
                                {{ label }}
                                {%- if product_count != null -%}
                                  <span class="mega-menu-count">({{ product_count }})</span>
                                {%- endif -%}
                              </div>
                            {%- endif -%}
                          </a>
                        {%- endif -%}
                      {%- endfor -%}
                    </div>
                  </div>
                {%- endif -%}
              </div>
            </div>
          {%- else -%}
            <a href="{{ link.url }}" class="dock-link {% if link.active %}active{% endif %}">
              {{ link.title }}
            </a>
          {%- endif -%}
        </li>
      {%- else -%}
        <li class="dock-menu-item"><a href="#" class="dock-link">ABOUT</a></li>
        <li class="dock-menu-item"><a href="#" class="dock-link">SHOP</a></li>
        <li class="dock-menu-item"><a href="#" class="dock-link">COLLECTION</a></li>
        <li class="dock-menu-item"><a href="#" class="dock-link">CONTACT</a></li>
      {%- endfor -%}
    </ul>
  </nav>
  
  <div class="dock-actions">
    {%- for block in section.blocks -%}
      {%- if block.type == 'search' -%}
        <div class="dock-action-block dock-search" {{ block.shopify_attributes }}>
          <a href="{{ routes.search_url }}" class="dock-search-link" aria-label="Search">
            <svg class="dock-search-icon" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M9 17C13.4183 17 17 13.4183 17 9C17 4.58172 13.4183 1 9 1C4.58172 1 1 4.58172 1 9C1 13.4183 4.58172 17 9 17Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M19 19L14.65 14.65" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </a>
        </div>
      {%- endif -%}
      
      {%- if block.type == 'welcome' -%}
        <div class="dock-action-block dock-welcome" {{ block.shopify_attributes }}>
          <a href="{{ block.settings.login_url | default: routes.account_login_url }}" class="dock-welcome-link">
            {%- assign avatar_size = block.settings.avatar_size | default: 32 -%}
            {%- assign avatar_shape = block.settings.avatar_shape | default: 'circle' -%}
            <div class="dock-welcome-icon dock-welcome-icon--{{ avatar_shape }}" style="width: {{ avatar_size }}px; height: {{ avatar_size }}px;">
              {%- if block.settings.avatar_image != blank -%}
                {{
                  block.settings.avatar_image
                  | image_url: width: 128
                  | image_tag: loading: 'lazy', alt: block.settings.welcome_text, class: 'dock-welcome-avatar', style: 'width: 100%; height: 100%; object-fit: cover;'
                }}
              {%- else -%}
                <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" style="width: {{ avatar_size | times: 0.75 }}px; height: {{ avatar_size | times: 0.75 }}px;">
                  <path d="M20 21V19C20 17.9391 19.5786 16.9217 18.8284 16.1716C18.0783 15.4214 17.0609 15 16 15H8C6.93913 15 5.92172 15.4214 5.17157 16.1716C4.42143 16.9217 4 17.9391 4 19V21" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  <circle cx="12" cy="7" r="4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
              {%- endif -%}
            </div>
            <div class="dock-welcome-text">
              <div class="dock-welcome-greeting">{{ block.settings.welcome_text | default: 'Welcome !' }}</div>
              <div class="dock-welcome-login">{{ block.settings.login_text | default: 'Login' }}</div>
            </div>
          </a>
        </div>
      {%- endif -%}
    {%- endfor -%}
  </div>
</header>

<script src="{{ 'mega-menu.js' | asset_url }}" defer="defer"></script>

{% schema %}
{
  "name": "Floating Dock Header",
  "settings": [
    {
      "type": "link_list",
      "id": "menu",
      "default": "main-menu",
      "label": "Menu"
    }
  ],
  "blocks": [
    {
      "type": "search",
      "name": "Search",
      "limit": 1
    },
    {
      "type": "welcome",
      "name": "Welcome Block",
      "limit": 1,
      "settings": [
        {
          "type": "text",
          "id": "welcome_text",
          "label": "Welcome Text",
          "default": "Welcome !"
        },
        {
          "type": "text",
          "id": "login_text",
          "label": "Login Text",
          "default": "Login"
        },
        {
          "type": "url",
          "id": "login_url",
          "label": "Login URL",
          "info": "Leave empty to use default login page"
        },
        {
          "type": "header",
          "content": "Avatar Settings"
        },
        {
          "type": "image_picker",
          "id": "avatar_image",
          "label": "Avatar Image",
          "info": "Upload a custom avatar image. If not provided, default icon will be used."
        },
        {
          "type": "range",
          "id": "avatar_size",
          "min": 24,
          "max": 64,
          "step": 2,
          "unit": "px",
          "label": "Avatar Size",
          "default": 32
        },
        {
          "type": "select",
          "id": "avatar_shape",
          "label": "Avatar Shape",
          "options": [
            { "value": "circle", "label": "Circle" },
            { "value": "square", "label": "Square" },
            { "value": "rounded", "label": "Rounded" }
          ],
          "default": "circle"
        }
      ]
    },
    {
      "type": "mega_menu",
      "name": "Mega Menu",
      "settings": [
        {
          "type": "text",
          "id": "link_name",
          "label": "Menu Item Title",
          "info": "Case-sensitive match with the menu item title"
        },
        {
          "type": "header",
          "content": "Image 1"
        },
        {
          "type": "image_picker",
          "id": "image_1",
          "label": "Image"
        },
        {
          "type": "text",
          "id": "label_1",
          "label": "Label"
        },
        {
          "type": "url",
          "id": "link_1",
          "label": "Link"
        },
        {
          "type": "header",
          "content": "Image 2"
        },
        {
          "type": "image_picker",
          "id": "image_2",
          "label": "Image"
        },
        {
          "type": "text",
          "id": "label_2",
          "label": "Label"
        },
        {
          "type": "url",
          "id": "link_2",
          "label": "Link"
        },
        {
          "type": "header",
          "content": "Image 3"
        },
        {
          "type": "image_picker",
          "id": "image_3",
          "label": "Image"
        },
        {
          "type": "text",
          "id": "label_3",
          "label": "Label"
        },
        {
          "type": "url",
          "id": "link_3",
          "label": "Link"
        },
        {
          "type": "header",
          "content": "Image 4"
        },
        {
          "type": "image_picker",
          "id": "image_4",
          "label": "Image"
        },
        {
          "type": "text",
          "id": "label_4",
          "label": "Label"
        },
        {
          "type": "url",
          "id": "link_4",
          "label": "Link"
        }
      ]
    }
  ]
}
{% endschema %}
