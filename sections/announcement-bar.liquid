{{ 'announcement-bar.css' | asset_url | stylesheet_tag }}
<script src="{{ 'announcement-bar.js' | asset_url }}" defer="defer"></script>

{%- liquid
  assign show_bar = true
  if section.blocks.size == 0
    assign show_bar = false
  endif
-%}

{%- if show_bar -%}
  {%- liquid
    assign speed = section.settings.marquee_speed | default: 5
    assign duration = 11 | minus: speed | times: 10
  -%}
  <announcement-bar
    class="announcement-bar announcement-bar--{{ section.settings.layout_mode }} color-{{ section.settings.color_scheme }}{% if section.settings.sticky %} is-sticky{% endif %}"
    id="section-{{ section.id }}"
    style="--marquee-speed: {{ duration }}s;"
  >
    <div class="announcement-bar__inner">
      {%- if section.settings.layout_mode == 'marquee' -%}
        <div class="marquee-content">
          {%- for i in (1..4) -%}
            {%- for block in section.blocks -%}
              <div class="marquee-item" {{ block.shopify_attributes }}>
                {%- case block.type -%}
                  {%- when 'announcement' -%}
                    {%- if block.settings.link != blank -%}
                      <a href="{{ block.settings.link }}" class="announcement-bar__link h5">
                    {%- endif -%}
                    <span>{{ block.settings.text | escape }}</span>
                    {%- if block.settings.link != blank -%}
                      </a>
                    {%- endif -%}

                  {%- when 'countdown' -%}
                    <div class="announcement-countdown" data-countdown="{{ block.settings.end_date }}">
                      {%- if block.settings.label != blank -%}
                        <span class="countdown-label">{{ block.settings.label | escape }}</span>
                      {%- endif -%}
                      <span class="countdown-box d">00</span>: <span class="countdown-box h">00</span>:
                      <span class="countdown-box m">00</span>:
                      <span class="countdown-box s">00</span>
                    </div>
                {%- endcase -%}
              </div>
            {%- endfor -%}
          {%- endfor -%}
        </div>
      {%- else -%}
        <div class="announcement-bar__static">
          {%- for block in section.blocks limit: 1 -%}
            <p class="announcement-bar__message h5">{{ block.settings.text | escape }}</p>
          {%- endfor -%}
        </div>
      {%- endif -%}

      {%- if section.settings.show_close_button -%}
        <button type="button" class="announcement-bar__close" aria-label="Close">
          <svg viewBox="0 0 24 24" width="16" height="16">
            <path d="M18 6L6 18M6 6l12 12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          </svg>
        </button>
      {%- endif -%}
    </div>
  </announcement-bar>
{%- endif -%}

{% schema %}
{
  "name": " Announcement",
  "max_blocks": 12,
  "settings": [
    {
      "type": "select",
      "id": "layout_mode",
      "options": [
        { "value": "static", "label": "Static" },
        { "value": "marquee", "label": "Marquee (Scrolling)" }
      ],
      "default": "marquee",
      "label": "Layout Mode"
    },
    {
      "type": "range",
      "id": "marquee_speed",
      "min": 1,
      "max": 10,
      "step": 1,
      "label": "Animation Speed",
      "default": 5,
      "info": "1 is slowest, 10 is fastest"
    },
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "Color Scheme",
      "default": "scheme-4"
    },
    {
      "type": "checkbox",
      "id": "sticky",
      "default": true,
      "label": "Is Sticky?"
    },
    {
      "type": "checkbox",
      "id": "show_close_button",
      "default": true,
      "label": "Show Close Button"
    }
  ],
  "blocks": [
    {
      "type": "announcement",
      "name": "Announcement",
      "settings": [
        {
          "type": "text",
          "id": "text",
          "default": "Welcome to our store",
          "label": "Text"
        },
        {
          "type": "url",
          "id": "link",
          "label": "Link"
        }
      ]
    },
    {
      "type": "countdown",
      "name": "Countdown Timer",
      "settings": [
        {
          "type": "text",
          "id": "label",
          "default": "Ends in:",
          "label": "Label"
        },
        {
          "type": "text",
          "id": "end_date",
          "placeholder": "2025-12-31T23:59:59",
          "label": "End Date (ISO Format)",
          "info": "Format: YYYY-MM-DDTHH:MM:SS"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": " Announcement",
      "blocks": [{ "type": "announcement" }]
    }
  ]
}
{% endschema %}
